{% extends "base.html" %}
{% block content %}
<h2>Dochádzka</h2>

<!-- Form to start shift -->
<form method="POST" class="row g-3 mb-3">
  <div class="col-md-4">
    <select class="form-select" name="employee_id" required>
      <option value="">Vyberte zamestnanca</option>
      {% for e in employees %}
        <option value="{{ e.id }}">{{ e.name }} {{ e.surname }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-4">
    <select class="form-select" name="work_location" required>
      <option value="">Vyberte miesto</option>
      {% for location in work_locations %}
        <option value="{{ location }}">{{ location }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-4">
    <button class="btn btn-primary">Začať smenu</button>
  </div>
</form>

<table class="table table-bordered table-striped">
  <thead class="table-dark">
    <tr>
      <th>Zamestnanec</th>
      <th>Dátum</th>
      <th>Začiatok</th>
      <th>Koniec</th>
      <th>Hodiny</th>
      <th>Miesto</th>
      <th>Status</th>
      <th>Akcie</th>
    </tr>
  </thead>
  <tbody>
  {% for r in records %}
  <tr>
    <td>{{ r.employee.name }} {{ r.employee.surname }}</td>
    <td>{{ r.date }}</td>
    <td>{{ r.start_time.strftime('%H:%M') }}</td>
    <td>
      {% if r.end_time %}
        {{ r.end_time.strftime('%H:%M') }}
      {% else %}
        <span class="text-muted">Prebieha...</span>
      {% endif %}
    </td>
    <td>{{ r.hours_worked() }}</td>
    <td>{{ r.work_location }}</td>
    <td>
      {% if r.end_time %}
        <span class="badge bg-success">Dokončené</span>
      {% else %}
        <span class="badge bg-warning text-dark">Aktívne</span>
      {% endif %}
    </td>
    <td>
      {% if not r.end_time %}
        <a href="/end_shift/{{ r.id }}" class="btn btn-sm btn-success">Ukončiť</a>
      {% endif %}
      <a href="/edit_attendance/{{ r.id }}" class="btn btn-sm btn-warning">Edit</a>
      <a href="/delete_attendance/{{ r.id }}" class="btn btn-sm btn-danger" onclick="return confirm('Naozaj chcete odstrániť tento záznam?')">Delete</a>
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>

<!-- API Documentation -->
<div class="card mt-4">
  <div class="card-header">
    <h5>API pre ESP32</h5>
  </div>
  <div class="card-body">
    <p>Pre používanie s ESP32 použite tieto endpointy:</p>
    
    <h6>Začať smenu:</h6>
    <code>POST /api/start_shift</code>
    <pre>{
  "employee_id": 1,
  "work_location": "Zoo"
}</pre>
    
    <h6>Ukončiť smenu:</h6>
    <code>POST /api/end_shift</code>
    <pre>{
  "attendance_id": 5
}</pre>
    alebo
    <pre>{
  "employee_id": 1
}</pre>
  </div>
</div>
{% endblock %}